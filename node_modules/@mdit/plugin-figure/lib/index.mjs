const f=(i,r)=>{i.attrs=(i.attrs||[]).filter(([e])=>e!==r)},d=i=>{const r=i.attrs?.find(([e])=>e==="title")?.[1];return r?(f(i,"title"),r):i.content},u=(i,r={})=>{i.core.ruler.before("linkify","figure",e=>{for(let t=1,{length:o}=e.tokens;t<o-1;t++){const n=e.tokens[t];if(n.type!=="inline"||!n.children||n.children.length!==1&&n.children.length!==3||n.children.length===1&&n.children[0].type!=="image")continue;if(n.children.length===3){const[p,g,a]=n.children;if(p.type!=="link_open"||g.type!=="image"||a.type!=="link_close")continue}if(t!==0&&e.tokens[t-1].type!=="paragraph_open"||t!==o-1&&e.tokens[t+1].type!=="paragraph_close")continue;const c=e.tokens[t-1];c.type="figure_open",c.tag="figure",e.tokens[t+1].type="figure_close",e.tokens[t+1].tag="figure";const l=n.children.length===1?n.children[0]:n.children[1],s=d(l),[h]=i.parseInline(s,e.env);n.children.push(new e.Token("figcaption_open","figcaption",1)),n.children.push(...h.children||[]),n.children.push(new e.Token("figcaption_close","figcaption",-1)),r.focusable!==!1&&l.attrPush(["tabindex","0"])}})};export{u as figure};
//# sourceMappingURL=index.mjs.map
