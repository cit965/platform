"use strict";const g=(e,s,h)=>{let o;const a=s,i={ok:!1,pos:s,value:""};for(o=e.charAt(s);s<h&&o.match(/\d/)||o==="%";)o=e.charAt(++s);return i.ok=!0,i.pos=s,i.value=e.slice(a,s),i},A=(e,s,h)=>{const o={ok:!1,pos:0,width:"",height:""};if(s>=h||e.charAt(s)!=="=")return o;s+=1;const a=e.charAt(s);if(a!=="x"&&!a.match(/\d/))return o;const i=g(e,s,h);if(s=i.pos,e.charAt(s)!=="x")return o;s+=1;const r=g(e,s,h);return s=r.pos,o.width=i.value,o.height=r.value,o.pos=s,o.ok=!0,o},k=(e,s)=>{const h=e.env,o=e.pos,a=e.posMax;if(e.src.charAt(e.pos)!=="!"||e.src.charAt(e.pos+1)!=="[")return!1;const i=e.pos+2,r=e.md.helpers.parseLinkLabel(e,e.pos+1,!1);if(r<0)return!1;let t=r+1,n,p="",l="",m="",d="";if(t<a&&e.src.charAt(t)==="("){for(t+=1;t<a&&(n=e.src.charAt(t),!(n!==" "&&n!=="	"));t++);if(t>=a)return!1;let c;c=e.md.helpers.parseLinkDestination(e.src,t,e.posMax),c.ok&&(p=e.md.normalizeLink(c.str),e.md.validateLink(p)?t=c.pos:p="");const f=t;for(;t<a&&(n=e.src.charAt(t),!(n!==" "&&n!=="	"));t++);if(c=e.md.helpers.parseLinkTitle(e.src,t,e.posMax),t<a&&f!==t&&c.ok)for(l=c.str,t=c.pos;t<a&&(n=e.src.charAt(t),!(n!==" "&&n!=="	"));t++);else l="";if(t-1>=0&&(n=e.src.charAt(t-1),n===" "&&(c=A(e.src,t,e.posMax),c.ok)))for(m=c.width,d=c.height,t=c.pos;t<a&&(n=e.src.charAt(t),!(n!==" "&&n!==`
`));t++);if(t>=a||e.src.charAt(t)!==")")return e.pos=o,!1;t+=1}else{let c="";if(typeof h.references>"u")return!1;for(;t<a&&(n=e.src.charAt(t),!(n!==" "&&n!=="	"));t++);if(t<a&&e.src.charAt(t)==="["){const u=t+1;t=e.md.helpers.parseLinkLabel(e,t),t>=0?c=e.src.slice(u,t++):t=r+1}else t=r+1;c||(c=e.src.slice(i,r));const f=h.references[e.md.utils.normalizeReference(c)];if(!f)return e.pos=o,!1;p=f.href,l=f.title||""}if(!s){e.pos=i,e.posMax=r;const c=e.src.slice(i,r),f=[];e.md.inline.parse(c,e.md,e.env,f);const u=e.push("image","img",0);u.attrs=[["src",p],["alt",""]],l&&u.attrs.push(["title",l]),m!==""&&u.attrs.push(["width",m]),d!==""&&u.attrs.push(["height",d]),u.children=f,u.content=c}return e.pos=t,e.posMax=a,!0},x=e=>{e.inline.ruler.before("emphasis","image",k)},L=e=>{const s=e.renderer.rules.image;e.renderer.rules.image=(h,o,a,i,r)=>{const t=h[o],n=t.children?.[0]?.content;if(n){const p=/^(.*)\|(\d*)(?:x(\d*))?$/.exec(n);if(p){const[,l,m,d]=p;t.content=l,t.children[0].content=l,t.attrSet("width",m),typeof d=="string"&&t.attrSet("height",d)}}return s(h,o,a,i,r)}};exports.imgSize=x,exports.obsidianImageSize=L;
//# sourceMappingURL=index.cjs.map
