{"version":3,"file":"config.js","sources":["../../src/client/define.ts","../../src/client/utils/icon.ts","../../src/client/utils/images.ts","../../src/client/composables/setup.ts","../../src/client/config.ts"],"sourcesContent":["import type { PhotoSwipeLocaleData } from \"../shared/index.js\";\n\ndeclare const PHOTO_SWIPE_SELECTOR: string | string[];\ndeclare const PHOTO_SWIPE_DELAY: number;\ndeclare const PHOTO_SWIPE_LOCALES: Record<\n  string,\n  Record<`${keyof PhotoSwipeLocaleData}Title`, string>\n>;\ndeclare const PHOTO_SWIPE_SCROLL_TO_CLOSE: boolean;\n\nexport const imageSelector = PHOTO_SWIPE_SELECTOR;\n\nexport const locales = PHOTO_SWIPE_LOCALES;\nexport const delay = PHOTO_SWIPE_DELAY;\n\nexport const scrollToClose = PHOTO_SWIPE_SCROLL_TO_CLOSE;\n","export const LOADING_ICON =\n  '<div class=\"photo-swipe-loading\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"48\" height=\"48\" preserveAspectRatio=\"xMidYMid\" viewBox=\"25 25 50 50\"><animateTransform attributeName=\"transform\" type=\"rotate\" dur=\"2s\" keyTimes=\"0;1\" repeatCount=\"indefinite\" values=\"0;360\"></animateTransform><circle cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"4\" stroke-linecap=\"round\"><animate attributeName=\"stroke-dasharray\" dur=\"1.5s\" keyTimes=\"0;0.5;1\" repeatCount=\"indefinite\" values=\"1,200;90,200;1,200\"></animate><animate attributeName=\"stroke-dashoffset\" dur=\"1.5s\" keyTimes=\"0;0.5;1\" repeatCount=\"indefinite\" values=\"0;-35px;-125px\"></animate></circle></svg></div>';\n","import { isString } from \"@vuepress/shared\";\nimport type { SlideData } from \"photoswipe\";\n\nexport const getImages = (selector: string | string[]): HTMLImageElement[] =>\n  isString(selector)\n    ? Array.from(document.querySelectorAll<HTMLImageElement>(selector))\n    : selector\n        .map((item) =>\n          Array.from(document.querySelectorAll<HTMLImageElement>(item)),\n        )\n        .flat();\n\nexport const getImageInfo = (image: HTMLImageElement): Promise<SlideData> =>\n  new Promise<SlideData>((resolve, reject) => {\n    if (image.complete) {\n      resolve({\n        type: \"image\",\n        element: image,\n        src: image.src,\n        width: image.naturalWidth,\n        height: image.naturalHeight,\n        alt: image.alt,\n        msrc: image.src,\n      });\n    } else {\n      image.onload = (): void => resolve(getImageInfo(image));\n      image.onerror = (err): void => reject(err);\n    }\n  });\n","import { usePageData, usePageFrontmatter } from \"@vuepress/client\";\nimport { useEventListener, useFullscreen } from \"@vueuse/core\";\nimport type { SlideData } from \"photoswipe\";\nimport type PhotoSwipe from \"photoswipe\";\nimport { computed, nextTick, onMounted, watch } from \"vue\";\nimport { useLocaleConfig } from \"vuepress-shared/client\";\n\nimport { delay, imageSelector, locales, scrollToClose } from \"../define.js\";\nimport { usePhotoSwipeOptions } from \"../helpers/index.js\";\nimport { LOADING_ICON, getImageInfo, getImages } from \"../utils/index.js\";\n\nimport \"photoswipe/dist/photoswipe.css\";\nimport \"../styles/photo-swipe.scss\";\n\nexport const setupPhotoSwipe = (): void => {\n  const locale = useLocaleConfig(locales);\n  const frontmatter = usePageFrontmatter<{\n    photoSwipe?: string[] | string | false;\n  }>();\n  const page = usePageData();\n  const { isSupported, toggle } = useFullscreen();\n  const photoSwipeOptions = usePhotoSwipeOptions();\n\n  let instance: PhotoSwipe;\n\n  const selector = computed(() =>\n    frontmatter.value.photoSwipe === false\n      ? false\n      : frontmatter.value.photoSwipe || imageSelector,\n  );\n\n  const registerPhotoswipeUI = (photoSwipe: PhotoSwipe): void => {\n    photoSwipe.on(\"uiRegister\", () => {\n      if (isSupported)\n        // add fullscreen button\n        photoSwipe.ui!.registerElement({\n          name: \"fullscreen\",\n          order: 7,\n          isButton: true,\n\n          html: '<svg class=\"pswp__icn\" viewBox=\"0 0 1024 1024\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M249.5 270.833H437v-75H212a37.5 37.5 0 0 0-37.5 37.5v225h75v-187.5zm-37.5 600h225v-75H249.5v-187.5h-75v225a37.5 37.5 0 0 0 37.5 37.5zm637.5-37.5v-225h-75v187.5H587v75h225a37.5 37.5 0 0 0 37.5-37.5zM587 270.833h187.5v187.5h75v-225a37.5 37.5 0 0 0-37.5-37.5H587v75z\"/></svg>',\n\n          onClick: () => {\n            void toggle();\n          },\n        });\n\n      // add download button\n      photoSwipe.ui!.registerElement({\n        name: \"download\",\n        order: 8,\n        isButton: true,\n        tagName: \"a\",\n\n        // SVG with outline\n        html: {\n          isCustomSVG: true,\n          inner:\n            '<path d=\"M20.5 14.3 17.1 18V10h-2.2v7.9l-3.4-3.6L10 16l6 6.1 6-6.1-1.5-1.6ZM23 23H9v2h14\" id=\"pswp__icn-download\"/>',\n          outlineID: \"pswp__icn-download\",\n        },\n\n        onInit: (el, photoSwipe) => {\n          el.setAttribute(\"download\", \"\");\n          el.setAttribute(\"target\", \"_blank\");\n          el.setAttribute(\"rel\", \"noopener\");\n\n          photoSwipe.on(\"change\", () => {\n            el.setAttribute(\"href\", photoSwipe.currSlide!.data.src!);\n          });\n        },\n      });\n\n      // add bullets indicator\n      photoSwipe.ui!.registerElement({\n        name: \"bulletsIndicator\",\n        className: \"photo-swipe-bullets-indicator\",\n        appendTo: \"wrapper\",\n        onInit: (el, photoSwipe) => {\n          const bullets: HTMLElement[] = [];\n          let prevIndex = -1;\n\n          for (let i = 0; i < photoSwipe.getNumItems(); i++) {\n            const bullet = document.createElement(\"div\");\n\n            bullet.className = \"photo-swipe-bullet\";\n            bullet.onclick = (event: Event): void => {\n              photoSwipe.goTo(bullets.indexOf(<HTMLElement>event.target));\n            };\n            bullets.push(bullet);\n            el.appendChild(bullet);\n          }\n\n          photoSwipe.on(\"change\", () => {\n            if (prevIndex >= 0) bullets[prevIndex].classList.remove(\"active\");\n\n            bullets[photoSwipe.currIndex].classList.add(\"active\");\n            prevIndex = photoSwipe.currIndex;\n          });\n        },\n      });\n    });\n  };\n\n  const initPhotoSwipe = async (): Promise<void> => {\n    if (selector.value)\n      return Promise.all([\n        import(/* webpackChunkName: \"photo-swipe\" */ \"photoswipe\"),\n        nextTick().then(() =>\n          new Promise<void>((resolve) => setTimeout(resolve, delay)).then(() =>\n            getImages(selector.value as string[] | string),\n          ),\n        ),\n      ]).then(([{ default: PhotoSwipe }, images]) => {\n        const dataSource = images.map<SlideData>((image) => ({\n          html: LOADING_ICON,\n          element: image,\n          msrc: image.src,\n        }));\n\n        images.forEach((image, index) => {\n          const handler = (): void => {\n            instance = new PhotoSwipe({\n              preloaderDelay: 0,\n              showHideAnimationType: \"zoom\",\n              ...locale.value,\n              ...photoSwipeOptions,\n              dataSource,\n              index,\n              ...(scrollToClose\n                ? { closeOnVerticalDrag: true, wheelToZoom: false }\n                : {}),\n            });\n\n            registerPhotoswipeUI(instance);\n\n            instance.addFilter(\"thumbEl\", () => image);\n            instance.addFilter(\"placeholderSrc\", () => image.src);\n            instance.init();\n          };\n\n          image.style.cursor = \"zoom-in\";\n          image.addEventListener(\"click\", () => {\n            void handler();\n          });\n          image.addEventListener(\"keypress\", ({ key }) => {\n            if (key === \"Enter\") void handler();\n          });\n        });\n\n        images.forEach((image, index) => {\n          void getImageInfo(image).then((data) => {\n            dataSource.splice(index, 1, data);\n            instance?.refreshSlideContent(index);\n          });\n        });\n      });\n  };\n\n  onMounted(() => {\n    if (scrollToClose)\n      useEventListener(\"wheel\", () => {\n        instance?.close();\n      });\n\n    watch(() => page.value.path, initPhotoSwipe, { immediate: true });\n  });\n};\n","import { defineClientConfig } from \"@vuepress/client\";\n\nimport { setupPhotoSwipe } from \"./composables/index.js\";\nimport { injectPhotoSwipeConfig } from \"./helpers/index.js\";\n\nexport default defineClientConfig({\n  enhance: ({ app }) => {\n    injectPhotoSwipeConfig(app);\n  },\n  setup: () => {\n    setupPhotoSwipe();\n  },\n});\n"],"names":["imageSelector","locales","delay","scrollToClose","LOADING_ICON","getImages","selector","isString","item","getImageInfo","image","resolve","reject","err","setupPhotoSwipe","locale","useLocaleConfig","frontmatter","usePageFrontmatter","page","usePageData","isSupported","toggle","useFullscreen","photoSwipeOptions","usePhotoSwipeOptions","instance","computed","registerPhotoswipeUI","photoSwipe","el","bullets","prevIndex","i","bullet","event","initPhotoSwipe","nextTick","PhotoSwipe","images","dataSource","index","handler","key","data","onMounted","useEventListener","watch","defineClientConfig","app","injectPhotoSwipeConfig"],"mappings":"scAUO,MAAMA,EAAgB,qBAEhBC,EAAU,oBACVC,EAAQ,kBAERC,EAAgB,4BCfhBC,EACX,8qBCEWC,EAAaC,GACxBC,EAASD,CAAQ,EACb,MAAM,KAAK,SAAS,iBAAmCA,CAAQ,CAAC,EAChEA,EACG,IAAKE,GACJ,MAAM,KAAK,SAAS,iBAAmCA,CAAI,CAAC,CAC9D,EACC,KAEI,EAAAC,EAAgBC,GAC3B,IAAI,QAAmB,CAACC,EAASC,IAAW,CACtCF,EAAM,SACRC,EAAQ,CACN,KAAM,QACN,QAASD,EACT,IAAKA,EAAM,IACX,MAAOA,EAAM,aACb,OAAQA,EAAM,cACd,IAAKA,EAAM,IACX,KAAMA,EAAM,GACd,CAAC,GAEDA,EAAM,OAAS,IAAYC,EAAQF,EAAaC,CAAK,CAAC,EACtDA,EAAM,QAAWG,GAAcD,EAAOC,CAAG,EAE7C,CAAC,ECdUC,EAAkB,IAAY,CACzC,MAAMC,EAASC,EAAgBf,CAAO,EAChCgB,EAAcC,EAEjB,EACGC,EAAOC,EACP,EAAA,CAAE,YAAAC,EAAa,OAAAC,CAAO,EAAIC,IAC1BC,EAAoBC,EAAAA,EAE1B,IAAIC,EAEJ,MAAMpB,EAAWqB,EAAS,IACxBV,EAAY,MAAM,aAAe,GAC7B,GACAA,EAAY,MAAM,YAAcjB,CACtC,EAEM4B,EAAwBC,GAAiC,CAC7DA,EAAW,GAAG,aAAc,IAAM,CAC5BR,GAEFQ,EAAW,GAAI,gBAAgB,CAC7B,KAAM,aACN,MAAO,EACP,SAAU,GAEV,KAAM,8WAEN,QAAS,IAAM,CACRP,EACP,CAAA,CACF,CAAC,EAGHO,EAAW,GAAI,gBAAgB,CAC7B,KAAM,WACN,MAAO,EACP,SAAU,GACV,QAAS,IAGT,KAAM,CACJ,YAAa,GACb,MACE,sHACF,UAAW,oBACb,EAEA,OAAQ,CAACC,EAAID,IAAe,CAC1BC,EAAG,aAAa,WAAY,EAAE,EAC9BA,EAAG,aAAa,SAAU,QAAQ,EAClCA,EAAG,aAAa,MAAO,UAAU,EAEjCD,EAAW,GAAG,SAAU,IAAM,CAC5BC,EAAG,aAAa,OAAQD,EAAW,UAAW,KAAK,GAAI,CACzD,CAAC,CACH,CACF,CAAC,EAGDA,EAAW,GAAI,gBAAgB,CAC7B,KAAM,mBACN,UAAW,gCACX,SAAU,UACV,OAAQ,CAACC,EAAID,IAAe,CAC1B,MAAME,EAAyB,GAC/B,IAAIC,EAAY,GAEhB,QAASC,EAAI,EAAGA,EAAIJ,EAAW,cAAeI,IAAK,CACjD,MAAMC,EAAS,SAAS,cAAc,KAAK,EAE3CA,EAAO,UAAY,qBACnBA,EAAO,QAAWC,GAAuB,CACvCN,EAAW,KAAKE,EAAQ,QAAqBI,EAAM,MAAM,CAAC,CAC5D,EACAJ,EAAQ,KAAKG,CAAM,EACnBJ,EAAG,YAAYI,CAAM,CACvB,CAEAL,EAAW,GAAG,SAAU,IAAM,CACxBG,GAAa,GAAGD,EAAQC,CAAS,EAAE,UAAU,OAAO,QAAQ,EAEhED,EAAQF,EAAW,SAAS,EAAE,UAAU,IAAI,QAAQ,EACpDG,EAAYH,EAAW,SACzB,CAAC,CACH,CACF,CAAC,CACH,CAAC,CACH,EAEMO,EAAiB,SAA2B,CAChD,GAAI9B,EAAS,MACX,OAAO,QAAQ,IAAI,CACjB,OAA6C,YAAY,EACzD+B,EAAS,EAAE,KAAK,IACd,IAAI,QAAe1B,GAAY,WAAWA,EAAST,CAAK,CAAC,EAAE,KAAK,IAC9DG,EAAUC,EAAS,KAA0B,CAC/C,CACF,CACF,CAAC,EAAE,KAAK,CAAC,CAAC,CAAE,QAASgC,CAAW,EAAGC,CAAM,IAAM,CAC7C,MAAMC,EAAaD,EAAO,IAAgB7B,IAAW,CACnD,KAAMN,EACN,QAASM,EACT,KAAMA,EAAM,GACd,EAAE,EAEF6B,EAAO,QAAQ,CAAC7B,EAAO+B,IAAU,CAC/B,MAAMC,EAAU,IAAY,CAC1BhB,EAAW,IAAIY,EAAW,CACxB,eAAgB,EAChB,sBAAuB,OACvB,GAAGvB,EAAO,MACV,GAAGS,EACH,WAAAgB,EACA,MAAAC,EACA,GAAItC,EACA,CAAE,oBAAqB,GAAM,YAAa,EAAM,EAChD,EACN,CAAC,EAEDyB,EAAqBF,CAAQ,EAE7BA,EAAS,UAAU,UAAW,IAAMhB,CAAK,EACzCgB,EAAS,UAAU,iBAAkB,IAAMhB,EAAM,GAAG,EACpDgB,EAAS,KACX,CAAA,EAEAhB,EAAM,MAAM,OAAS,UACrBA,EAAM,iBAAiB,QAAS,IAAM,CAC/BgC,EAAAA,CACP,CAAC,EACDhC,EAAM,iBAAiB,WAAY,CAAC,CAAE,IAAAiC,CAAI,IAAM,CAC1CA,IAAQ,SAAcD,GAC5B,CAAC,CACH,CAAC,EAEDH,EAAO,QAAQ,CAAC7B,EAAO+B,IAAU,CAC1BhC,EAAaC,CAAK,EAAE,KAAMkC,GAAS,CACtCJ,EAAW,OAAOC,EAAO,EAAGG,CAAI,EAChClB,GAAU,oBAAoBe,CAAK,CACrC,CAAC,CACH,CAAC,CACH,CAAC,CACL,EAEAI,EAAU,IAAM,CACV1C,GACF2C,EAAiB,QAAS,IAAM,CAC9BpB,GAAU,OACZ,CAAC,EAEHqB,EAAM,IAAM5B,EAAK,MAAM,KAAMiB,EAAgB,CAAE,UAAW,EAAK,CAAC,CAClE,CAAC,CACH,EClKA,IAAeY,EAAAA,EAAmB,CAChC,QAAS,CAAC,CAAE,IAAAC,CAAI,IAAM,CACpBC,EAAuBD,CAAG,CAC5B,EACA,MAAO,IAAM,CACXnC,EAAgB,CAClB,CACF,CAAC"}