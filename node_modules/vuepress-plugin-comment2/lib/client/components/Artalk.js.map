{"version":3,"file":"Artalk.js","sources":["../../../src/client/components/Artalk.ts"],"sourcesContent":["import { usePageData, useSiteData } from \"@vuepress/client\";\nimport type Artalk from \"artalk\";\nimport type { VNode } from \"vue\";\nimport {\n  defineComponent,\n  h,\n  nextTick,\n  onMounted,\n  ref,\n  shallowRef,\n  watch,\n} from \"vue\";\nimport { LoadingIcon, isString } from \"vuepress-shared/client\";\n\nimport { useArtalkOptions } from \"../helpers/index.js\";\n\nimport \"artalk/dist/Artalk.css\";\nimport \"../styles/artalk.scss\";\n\nexport default defineComponent({\n  // eslint-disable-next-line vue/multi-word-component-names\n  name: \"Artalk\",\n\n  props: {\n    /**\n     * The path of the comment\n     */\n    identifier: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * Whether the component is in darkmode\n     *\n     * 组件是否处于夜间模式\n     */\n    darkmode: Boolean,\n  },\n\n  setup(props) {\n    const artalkOptions = useArtalkOptions();\n    const page = usePageData();\n    const site = useSiteData();\n\n    const loaded = ref(false);\n    const artalkContainer = shallowRef<HTMLDivElement>();\n\n    let artalk: Artalk | null = null;\n\n    const enableArtalk = isString(artalkOptions.server);\n\n    const initArtalk = async (): Promise<void> => {\n      const [{ default: Artalk }] = await Promise.all([\n        import(/* webpackChunkName: \"artalk\" */ \"artalk/dist/Artalk.es.js\"),\n        new Promise<void>((resolve) => {\n          setTimeout(() => {\n            resolve();\n          }, artalkOptions.delay || 800);\n        }),\n      ]);\n\n      loaded.value = true;\n      await nextTick();\n\n      try {\n        artalk = new Artalk({\n          useBackendConf: false,\n          site: site.value.title,\n          pageTitle: page.value.title,\n          ...artalkOptions,\n          el: artalkContainer.value!,\n          pageKey: props.identifier,\n          darkMode: props.darkmode,\n        });\n\n        if (artalkOptions.useBackendConf)\n          artalk.on(\"conf-loaded\", () => {\n            artalk!.setDarkMode(props.darkmode);\n          });\n      } catch (err) {\n        // FIXME: Not sure what the issue is, relevant issue:\n        // https://github.com/vuepress/vuepress-next/issues/1249\n        // https://github.com/ArtalkJS/Artalk/discussions/367\n      }\n    };\n\n    onMounted(() => {\n      watch(\n        () => props.identifier,\n        async () => {\n          try {\n            artalk?.destroy();\n          } catch (err) {\n            // do nothing\n          }\n          await initArtalk();\n        },\n        { immediate: true },\n      );\n\n      watch(\n        () => props.darkmode,\n        (value) => {\n          artalk?.setDarkMode(value);\n        },\n      );\n    });\n\n    return (): VNode | null =>\n      enableArtalk\n        ? h(\"div\", { class: \"artalk-wrapper\" }, [\n            loaded.value ? null : h(LoadingIcon),\n            h(\"div\", { ref: artalkContainer }),\n          ])\n        : null;\n  },\n});\n"],"names":["Artalk","defineComponent","props","artalkOptions","useArtalkOptions","page","usePageData","site","useSiteData","loaded","ref","artalkContainer","shallowRef","artalk","enableArtalk","isString","initArtalk","resolve","nextTick","onMounted","watch","value","h","LoadingIcon"],"mappings":"uVAmBA,IAAAA,EAAeC,EAAgB,CAE7B,KAAM,SAEN,MAAO,CAIL,WAAY,CACV,KAAM,OACN,SAAU,EACZ,EAOA,SAAU,OACZ,EAEA,MAAMC,EAAO,CACX,MAAMC,EAAgBC,IAChBC,EAAOC,EACPC,EAAAA,EAAOC,EAAY,EAEnBC,EAASC,EAAI,EAAK,EAClBC,EAAkBC,EAExB,EAAA,IAAIC,EAAwB,KAE5B,MAAMC,EAAeC,EAASZ,EAAc,MAAM,EAE5Ca,EAAa,SAA2B,CAC5C,KAAM,CAAC,CAAE,QAAShB,CAAO,CAAC,EAAI,MAAM,QAAQ,IAAI,CAC9C,OAAwC,0BAA0B,EAClE,IAAI,QAAeiB,GAAY,CAC7B,WAAW,IAAM,CACfA,EACF,CAAA,EAAGd,EAAc,OAAS,GAAG,CAC/B,CAAC,CACH,CAAC,EAEDM,EAAO,MAAQ,GACf,MAAMS,EAEN,EAAA,GAAI,CACFL,EAAS,IAAIb,EAAO,CAClB,eAAgB,GAChB,KAAMO,EAAK,MAAM,MACjB,UAAWF,EAAK,MAAM,MACtB,GAAGF,EACH,GAAIQ,EAAgB,MACpB,QAAST,EAAM,WACf,SAAUA,EAAM,QAClB,CAAC,EAEGC,EAAc,gBAChBU,EAAO,GAAG,cAAe,IAAM,CAC7BA,EAAQ,YAAYX,EAAM,QAAQ,CACpC,CAAC,CACL,MAAc,EAKhB,EAEA,OAAAiB,EAAU,IAAM,CACdC,EACE,IAAMlB,EAAM,WACZ,SAAY,CACV,GAAI,CACFW,GAAQ,QAAA,CACV,MAAc,EAGd,MAAMG,EACR,CAAA,EACA,CAAE,UAAW,EAAK,CACpB,EAEAI,EACE,IAAMlB,EAAM,SACXmB,GAAU,CACTR,GAAQ,YAAYQ,CAAK,CAC3B,CACF,CACF,CAAC,EAEM,IACLP,EACIQ,EAAE,MAAO,CAAE,MAAO,gBAAiB,EAAG,CACpCb,EAAO,MAAQ,KAAOa,EAAEC,CAAW,EACnCD,EAAE,MAAO,CAAE,IAAKX,CAAgB,CAAC,CACnC,CAAC,EACD,IACR,CACF,CAAC"}