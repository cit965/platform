{"version":3,"file":"config.js","sources":["../../src/client/components/AutoCatalog.ts","../../src/client/config.ts"],"sourcesContent":["import { usePageData, useSiteData } from \"@vuepress/client\";\nimport type { VNode } from \"vue\";\nimport { computed, defineComponent, h } from \"vue\";\nimport type { RouteMeta } from \"vue-router\";\nimport { useRouter } from \"vue-router\";\nimport {\n  VPLink,\n  endsWith,\n  keys,\n  startsWith,\n  useLocaleConfig,\n} from \"vuepress-shared/client\";\n\nimport type { AutoCatalogLocaleConfig } from \"../../shared/index.js\";\nimport { useAutoCatalogIconComponent } from \"../helpers/index.js\";\n\nimport \"../styles/auto-catalog.scss\";\n\ndeclare const AUTO_CATALOG_LOCALES: AutoCatalogLocaleConfig;\ndeclare const AUTO_CATALOG_TITLE_META_KEY: string;\ndeclare const AUTO_CATALOG_ICON_META_KEY: string;\ndeclare const AUTO_CATALOG_ORDER_META_KEY: string;\ndeclare const AUTO_CATALOG_INDEX_META_KEY: string;\n\nexport interface AutoCatalogProps {\n  base?: string;\n  level?: 1 | 2 | 3;\n}\n\ninterface CatalogInfo {\n  title: string;\n  icon: string | null;\n  base: string;\n  order: number | null;\n  level: number;\n  path: string;\n  children?: CatalogInfo[];\n}\n\nexport default defineComponent({\n  name: \"AutoCatalog\",\n\n  props: {\n    /**\n     * Catalog Base\n     *\n     * 目录的基础路径\n     *\n     * @default current route base\n     */\n    base: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Max level of catalog\n     *\n     * @description only 1,2,3 are supported\n     *\n     * Catalog 的最大层级\n     *\n     * @description 目前仅支持 1,2,3\n     *\n     * @default 3\n     */\n    level: {\n      type: Number,\n      default: 3,\n    },\n\n    /**\n     * Whether show index for catalog\n     *\n     * 目录是否显示索引\n     */\n    index: Boolean,\n\n    /**\n     * Whether hide `Category` title\n     *\n     * 是否隐藏 `目录` 标题\n     *\n     * @default false\n     */\n    hideHeading: Boolean,\n  },\n\n  setup(props) {\n    const iconComponent = useAutoCatalogIconComponent();\n    const locale = useLocaleConfig(AUTO_CATALOG_LOCALES);\n    const page = usePageData();\n    const router = useRouter();\n    const siteData = useSiteData();\n\n    const CatalogIcon = (icon?: string | null): VNode | null =>\n      icon ? h(iconComponent, { icon }) : null;\n\n    const CatalogLink = ({\n      title,\n      path,\n      icon,\n      class: className,\n    }: {\n      title: string;\n      path: string;\n      icon?: string | null;\n      class: string;\n    }): VNode =>\n      h(VPLink, { class: className, to: path }, () => [\n        CatalogIcon(icon),\n        title || path,\n      ]);\n\n    const shouldIndex = (meta: RouteMeta): boolean => {\n      const index = <boolean | undefined>meta[AUTO_CATALOG_INDEX_META_KEY];\n\n      return typeof index === \"undefined\" || index;\n    };\n\n    const getCatalogInfo = (): CatalogInfo[] => {\n      const base = props.base || page.value.path.replace(/\\/[^/]+$/, \"/\");\n      const routes = router.getRoutes();\n      const result: CatalogInfo[] = [];\n\n      routes\n        .filter(({ meta, path }) => {\n          // filter those under current base\n          if (!startsWith(path, base) || path === base) return false;\n\n          if (base === \"/\") {\n            const otherLocales = keys(siteData.value.locales).filter(\n              (item) => item !== \"/\",\n            );\n\n            // exclude 404 page and other locales\n            if (\n              path === \"/404.html\" ||\n              otherLocales.some((localePath) => startsWith(path, localePath))\n            )\n              return false;\n          }\n\n          return (\n            // filter real page\n            ((endsWith(path, \".html\") && !endsWith(path, \"/index.html\")) ||\n              endsWith(path, \"/\")) &&\n            // page should be indexed\n            shouldIndex(meta)\n          );\n        })\n        .map(({ path, meta }) => {\n          const level = path.substring(base.length).split(\"/\").length;\n\n          return {\n            title: <string>meta[AUTO_CATALOG_TITLE_META_KEY] || \"\",\n            icon:\n              <string | null | undefined>meta[AUTO_CATALOG_ICON_META_KEY] ||\n              null,\n            base: path.replace(/\\/[^/]+\\/?$/, \"/\"),\n            order:\n              <number | null | undefined>meta[AUTO_CATALOG_ORDER_META_KEY] ||\n              null,\n            level: endsWith(path, \"/\") ? level - 1 : level,\n            path,\n          };\n        })\n        .filter(({ title, level }) => title && level <= props.level)\n        .sort(\n          (\n            { title: titleA, level: levelA, path: pathA, order: orderA },\n            { title: titleB, level: levelB, path: pathB, order: orderB },\n          ) => {\n            const level = levelA - levelB;\n\n            if (level) return level;\n\n            // check README.md, it should be first one\n            if (endsWith(pathA, \"/index.html\")) return -1;\n            if (endsWith(pathB, \"/index.html\")) return 1;\n\n            // infoA order is absent\n            if (orderA === null) {\n              // infoB order is absent\n              if (orderB === null)\n                // compare title\n                return titleA.localeCompare(titleB);\n\n              // infoB order is present\n              return orderB;\n            }\n\n            // infoB order is absent\n            if (orderB === null) return orderA;\n\n            // now we are sure both order exist\n\n            // infoA order is positive\n            if (orderA > 0) {\n              if (orderB > 0) return orderA - orderB;\n\n              return -1;\n            }\n\n            // both order are negative\n            if (orderB < 0) return orderA - orderB;\n\n            return 1;\n          },\n        )\n        .forEach((info) => {\n          const { base, level } = info;\n\n          switch (level) {\n            case 1:\n              result.push(info);\n              break;\n\n            case 2: {\n              const parent = result.find((item) => item.path === base);\n\n              if (parent) (parent.children ??= []).push(info);\n              break;\n            }\n\n            default: {\n              const grandParent = result.find(\n                (item) => item.path === base.replace(/\\/[^/]+\\/$/, \"/\"),\n              );\n\n              if (grandParent) {\n                const parent = grandParent.children?.find(\n                  (item) => item.path === base,\n                );\n\n                if (parent) (parent.children ??= []).push(info);\n              }\n            }\n          }\n        });\n\n      return result;\n    };\n\n    const info = computed(() => getCatalogInfo());\n\n    return (): VNode => {\n      const isDeep = info.value.some((item) => item.children);\n\n      return h(\n        \"div\",\n        { class: [\"vp-catalog-wrapper\", { index: props.index }] },\n        [\n          props.hideHeading\n            ? null\n            : h(\"h2\", { class: \"vp-catalog-main-title\" }, locale.value.title),\n          info.value.length\n            ? h(\n                props.index ? \"ol\" : \"ul\",\n                { class: [\"vp-catalogs\", { deep: isDeep }] },\n                info.value.map(({ children = [], icon, path, title }) => {\n                  const childLink = CatalogLink({\n                    title,\n                    path,\n                    icon,\n                    class: \"vp-catalog-title\",\n                  });\n\n                  return h(\n                    \"li\",\n                    { class: \"vp-catalog\" },\n                    isDeep\n                      ? [\n                          h(\n                            \"h3\",\n                            {\n                              id: title,\n                              class: [\n                                \"vp-catalog-child-title\",\n                                { \"has-children\": children.length },\n                              ],\n                            },\n                            [\n                              h(\n                                \"a\",\n                                {\n                                  href: `#${title}`,\n                                  class: \"header-anchor\",\n                                  \"aria-hidden\": true,\n                                },\n                                \"#\",\n                              ),\n                              childLink,\n                            ],\n                          ),\n                          children.length\n                            ? h(\n                                props.index ? \"ol\" : \"ul\",\n                                { class: \"vp-child-catalogs\" },\n                                children.map(\n                                  ({ children = [], icon, path, title }) =>\n                                    h(\"li\", { class: \"vp-child-catalog\" }, [\n                                      h(\n                                        \"div\",\n                                        {\n                                          class: [\n                                            \"vp-catalog-sub-title\",\n                                            { \"has-children\": children.length },\n                                          ],\n                                        },\n                                        [\n                                          h(\n                                            \"a\",\n                                            {\n                                              href: `#${title}`,\n                                              class: \"header-anchor\",\n                                            },\n                                            \"#\",\n                                          ),\n                                          h(CatalogLink, {\n                                            title,\n                                            path,\n                                            icon,\n                                            class: \"vp-catalog-title\",\n                                          }),\n                                        ],\n                                      ),\n                                      children.length\n                                        ? h(\n                                            props.index ? \"ol\" : \"div\",\n                                            {\n                                              class: props.index\n                                                ? \"vp-sub-catalogs\"\n                                                : \"vp-sub-catalogs-wrapper\",\n                                            },\n                                            children.map(\n                                              ({ icon, path, title }) => {\n                                                const subLink = h(CatalogLink, {\n                                                  title,\n                                                  path,\n                                                  icon,\n                                                  class: \"\",\n                                                });\n\n                                                return props.index\n                                                  ? h(\n                                                      \"li\",\n                                                      {\n                                                        class: \"vp-sub-catalog\",\n                                                      },\n                                                      subLink,\n                                                    )\n                                                  : h(CatalogLink, {\n                                                      title,\n                                                      path,\n                                                      icon,\n                                                      class:\n                                                        \"vp-sub-catalog-link\",\n                                                    });\n                                              },\n                                            ),\n                                          )\n                                        : null,\n                                    ]),\n                                ),\n                              )\n                            : null,\n                        ]\n                      : h(\n                          \"div\",\n                          { class: \"vp-catalog-child-title\" },\n                          childLink,\n                        ),\n                  );\n                }),\n              )\n            : h(\"p\", { class: \"vp-empty-catalog\" }, locale.value.empty),\n        ],\n      );\n    };\n  },\n});\n","import { defineClientConfig } from \"@vuepress/client\";\nimport { hasGlobalComponent } from \"vuepress-shared/client\";\n\nimport AutoCatalog from \"./components/AutoCatalog.js\";\nimport { injectAutoCatalogIconComponent } from \"./helpers/index.js\";\n\nexport default defineClientConfig({\n  enhance: ({ app }) => {\n    injectAutoCatalogIconComponent(app);\n    if (!hasGlobalComponent(\"AutoCatalog\", app))\n      app.component(\"AutoCatalog\", AutoCatalog);\n  },\n});\n"],"names":["e","defineComponent","props","iconComponent","useAutoCatalogIconComponent","locale","useLocaleConfig","page","usePageData","router","useRouter","siteData","useSiteData","CatalogIcon","icon","h","CatalogLink","title","path","className","VPLink","shouldIndex","meta","index","getCatalogInfo","base","routes","result","startsWith","otherLocales","keys","item","localePath","endsWith","level","titleA","levelA","pathA","orderA","titleB","levelB","pathB","orderB","info","parent","grandParent","computed","isDeep","children","childLink","subLink","config","defineClientConfig","app","injectAutoCatalogIconComponent","hasGlobalComponent","AutoCatalog"],"mappings":"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"}